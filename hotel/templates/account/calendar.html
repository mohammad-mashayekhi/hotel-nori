{% extends 'account/base.html' %}
{% load static %}

{% block vendors-css %}
<link rel="stylesheet" href="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/node-waves/node-waves.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/typeahead-js/typeahead.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/fullcalendar/fullcalendar.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/flatpickr/flatpickr.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/select2/select2.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/quill/editor.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/formvalidation/dist/css/formValidation.min.css' %}" />
<link href="{% static 'css/mobiscroll.javascript.min.css' %}" rel="stylesheet" />
<script src="{% static 'js/mobiscroll.javascript.min.js' %}"></script>

<!-- Bootstrap JavaScript (bundle includes Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

{% endblock %}

{% block page-css %}
<link rel="stylesheet" href="{% static 'vendor/css/pages/app-calendar.css' %}" />

<style>
.room1{
 border-bottom: 4px solid #003C43 !important;
 min-height: 52px !important;
}
.room1.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room2{
 border-bottom: 4px solid #135D66 !important;
 min-height: 52px !important;
}
.room2.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room3{
 border-bottom: 4px solid #77B0AA !important;
 min-height: 52px !important;
}
.room3.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room4{
 border-bottom: 4px solid #58A399 !important;
 min-height: 52px !important;
}
.room4.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room5{
 border-bottom: 4px solid #ADBC9F !important;
 min-height: 52px !important;
}
.room5.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room6{
 border-bottom: 4px solid #A8CD9F !important;
 min-height: 52px !important;
}
.room6.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room7{
 border-bottom: 4px solid #C6EBC5 !important;
 min-height: 52px !important;
}
.room7.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room8{
 border-bottom: 4px solid #F9E897 !important;
 min-height: 52px !important;
}
.room8.mbsc-timeline-resource {
  background: rgba(246, 231, 203, 0.7);
}
.room9{
 border-bottom: 4px solid #F2C18D !important;
 min-height: 52px !important;
}
.room9.mbsc-timeline-resource {
  background: rgba(246, 231, 203, 0.7);
}
.room10{
 border-bottom: 4px solid #A3333D !important;
 min-height: 52px !important;
}
.room10.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room11{
 border-bottom: 4px solid #e3c3c6 !important;
 min-height: 52px !important;
}
.room11.mbsc-timeline-resource {
  background:  rgba(246, 231, 203, 0.7);
}
.room12{
  border-bottom: 4px solid #590531 !important;
  min-height: 52px !important;
}
.room12.mbsc-timeline-resource {
  background: rgba(246, 231, 203, 0.7);
}
.mbsc-timeline-header .mbsc-flex .mbsc-ios .mbsc-rtl{
  background: rgba(246, 231, 203, 0.7) !important;
  font-weight: bold;
  
}
@media (min-width: 769px) {
.mbsc-timeline-resource-col, .mbsc-timeline-sidebar-col{
 width: 85px;
 } 
} 
@media (max-width: 768px) {
.mbsc-timeline-resource-col, .mbsc-timeline-sidebar-col{
 width: 65px;
} 
}

.container-xxl .flex-grow-1 .container-p-y{
 padding-right:0px;
}
.mbsc-timeline-column, .mbsc-timeline-header-column{
 width: 48px;
}
.mbsc-timeline-event-background{
  height: 36px !important;
}
@media (min-width: 769px) {
.mbsc-timeline-resource-title{
  text-align: center;
  font-size: 1em;
}
}
@media (max-width: 768px) {
  .mbsc-timeline-resource-title {
    text-align: center;
    font-size: 0.7em;
  }
}
.mbsc-calendar-controls{
  justify-content: center !important;
}
/* .mbsc-timeline-day-border{
  border-left: 3px solid rgb(198, 192, 192) !important; 
}  */
.md-lunch-break-class.mbsc-schedule-invalid {
    text-align: center;
    align-items: center;
    font-weight: bold;
    background: repeating-linear-gradient(-45deg, #f3f3f3, #f3f3f3 6px, #e5e5e5 11px, #e5e5e5 22px);
    background-color: #a9a9a99c !important;
}
.mbsc-button-mycalendar{
  background-color: #FFFFFF !important;
  /* border-radius: 15px; */
  margin: 20px;
  font-weight: bold;
}
</style>
{% endblock %}

{% block contant %}
<div class="container-xxl flex-grow-1 container-p-y">
  <div class="card app-calendar-wrapper">
    <div class="row g-0">
      <!-- Calendar & Modal -->
      <div id="demo-add-delete-event" class="md-date-header-template mbsc-cloak md-pages">
      </div>
      <div style="display: none">
        <div id="demo-add-popup">
          <div class="mbsc-form-group" style="margin: 20px;">
            <div class="row">
              <!-- First Column -->
              <div class="col-md-6">
                <label for="event-title">نام</label>
                <input type="text" class="form-control input" id="event-title" name="event-title" required>
                <label for="event-status">وضعیت</label>
                <select class="form-control" id="event-status" name="event-status" required>
                  <option value="pending_payment">در انتظار پرداخت</option>
                  <option value="confirmed">تایید شده</option>
                  <option value="closetime">غیرقابل رزرو</option>
                </select>
                <span id="event-capacity" name="event-capacity"></span><br>
                <input type="number" class="form-control" id="event-more-capacity" name="event-more-capacity"><br>
                <label for="event-cleaning">نظافت:</label>
                <input type="checkbox" id="event-cleaning" name="event-cleaning">
                <label for="event-paid">پرداخت حضوری:</label>
                <input type="checkbox" id="event-paid" name="event-paid">
              </div>
              <!-- Second Column -->
              <div class="col-md-6">
                <label for="event-user">شماره تلفن</label>
                <input type="tel" class="form-control input" id="event-user" name="event-user" required>
                <label for="event-resource">اتاق</label>
                <select class="form-control" id="event-resource" name="event-resource" required>
                  {% for resources in resources %}
                  <option value="{{resources.id}}">{{resources.name}}</option>
                  {% endfor %}
                </select>
                
                <label for="event-price-per-person">قیمت هر نفر مازاد</label>
                <span class="form-control" id="event-price-per-person" name="event-price-per-person"></span>
                <label for="event-price">قیمت هر شب</label>
                <span class="form-control" id="event-price" name="event-price"></span>
               
              </div>
            </div>
            <div class="container" style="text-align: -webkit-center">
              <div class="display:flex">
                <div class="col-md-8">
                  <table class="table">
                    <tbody>
                      <!-- Additional Fields (if any) -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="mbsc-form-group">
            <div mbsc-page class="demo-range-select">
              <div style="height:100%">
                <div id="demo-range-selection"></div>
              </div>
            </div>
            <div class="mbsc-button-group">
              <button class="mbsc-button-block" id="event-delete" mbsc-button data-color="danger" data-variant="outline">حذف رزرو</button>
              <button class="mbsc-button-block" id="event-pay" mbsc-button data-color="danger" data-variant="outline">مبلغ نهایی</button>
              <!-- <button class="mbsc-button-block" id="event-reminder" mbsc-button data-color="submit" data-variant="outline">ارسال پیامک یادآوری</button> -->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<!-- / Content -->
<script src="https://cdn.jsdelivr.net/npm/moment/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-jalaali/build/moment-jalaali.min.js"></script>
<script>
  mobiscroll.setOptions({
    locale: mobiscroll.localeFa,
    theme: 'ios',                 // Specify theme like: theme: 'ios' or omit setting to use default
    themeVariant: 'light'         // More info about themeVariant: https://mobiscroll.com/docs/javascript/datepicker/api#opt-themeVariant
  });
  var reservationData = {{ reservation_data|safe }};
  var resourceData = {{ resource_data|safe }};
  var invalidreservation = {{ closetime_data|safe }};

  
  var popup;
  var oldEvent;
  var tempEvent = {};
  var deleteEvent;
  var startcalendar = '2024-04-20';
  var endcalendar = '2025-04-20';
  var deleteButton = document.getElementById('event-delete');
  // var addremindersmsButton = document.getElementById('event-reminder');

  datepickerreserve = mobiscroll.datepicker('#demo-range-selection', {
    controls: ['calendar'],
    display: 'inline',   
    selectCounter:true,
    focusOnOpen:true,         // Specify display mode like: display: 'bottom' or omit setting to use default
    rangeSelectMode: 'wizard',
    select: 'range',              // More info about select: https://mobiscroll.com/docs/javascript/datepicker/api#opt-select
    showRangeLabels: true
  });
  
  function createAddPopup(elm,resourceId,tempEvent) {
    deleteButton.style.display = 'none';

    deleteEvent = true;
    restoreEvent = false;

    $('#event-title').val('');
    $('#event-status').val('');
    $('#event-user').val('');
    $('#event-buffer').val('');
    $('#start-input').val('');
    $('#end-input').val('');
    $('#event-resource').val(resourceId);
    var matchingResource = resourceData.find(function (resource) {
        return resource.id === resourceId;
    });
    $('#event-capacity').text(matchingResource.capacity + ' نفر مجاز/ظرفیت بیشتر ');
    $('#event-price').text(matchingResource.price);
    $('#event-cleaning').prop('checked',true);
    $('#event-more-capacity').val(0);
    $('#event-paid').prop('checked',false);

    $('#event-price-per-person').text(matchingResource.price_per_person),

    firstday = tempEvent.start;
    lastday = tempEvent.end;
    datepickerreserve.setVal([firstday, lastday]);

    // Calculate the difference in days
    var oneDay = 24 * 60 * 60 * 1000; // hours * minutes * seconds * milliseconds
    var differenceInDays = 0
    differenceInDays = Math.round((lastday - firstday) / oneDay);

    // Add one day to the difference
    differenceInDays += 1;

    // Get the resource price (replace this with your logic to get the actual price)
    console.log(matchingResource.price)
    console.log(differenceInDays)
    reserve_price = matchingResource.price
    // Calculate the total cost
    var totalCost = differenceInDays * reserve_price;

    // Set the value of the event-pay button
    $('#event-pay').text('مبلغ نهایی: ' + totalCost + ' تومان');

    popup.open();
      popup.setOptions({
          headerText: 'افزودن رزرو',
          buttons: [
              'cancel',
              {
                  text: 'ذخیره',
                  keyCode: 'enter',
                  handler: function () {
                    reservtime = datepickerreserve.getVal();
                    startreserve = reservtime[0];
                    endreserve = reservtime[1];
                    deleteEvent = false;
                      // ارسال درخواست AJAX برای اضافه کردن رزرو
                      $.ajax({
                          url: 'account/add_reservation/',
                          method: 'POST',
                          data: {
                              csrfmiddlewaretoken: '{{ csrf_token }}',
                              title: $('#event-title').val(),
                              user: $('#event-user').val(),
                              start: startreserve,
                              end: endreserve,
                              resourceId: $('#event-resource').val(), // اضافه کردن شناسه منبع به داده‌های ارسالی
                              status: $('#event-status').val(),
                              cleaning : $('#event-cleaning').prop('checked'),
                              more_capacity :  $('#event-more-capacity').val(),
                              paid: $('#event-paid').prop('checked'),
                              price: totalCost,
                          },
                          success: function(response) {
                              if (response.success) {
                                  // رزرو با موفقیت اضافه شد، می‌توانید هر عملیاتی که نیاز دارید را انجام دهید
                                  // به روز رسانی کلندر یا هر عملیات دیگر
                                  myCalendar.refresh();
                                  alert('رزرو با موفقیت اضافه شد!');
                              } else {
                                  alert('خطا در اضافه کردن رزرو!');
                              }
                          },
                          error: function() {
                              alert('خطا در ارسال درخواست!');
                          }
                      });
                      popup.close();
                  },
                  cssClass: 'mbsc-popup-button-primary',
              },
          ],
          anchor: elm,
          position: { top: 'auto', left: 'auto', right: 'auto', bottom: 'auto' },

      });
    }

  function createEditPopup(args,resourceId) {
    var ev = args.event;
    tempEvent = args.event;

    deleteButton.style.display = 'block';
    
    deleteEvent = false;
    restoreEvent = true;

    popup.setOptions({
      headerText: 'مشخصات رزرو',
      buttons: [
        'cancel',
        {
          text: 'ویرایش',
          keyCode: 'enter',
          handler: function () {
          popup.close();
          },
          cssClass: 'mbsc-popup-button-primary',
        },
      ],
      anchor: args.domEvent.currentTarget, // تنظیم موقعیت پاپ‌آپ بر اساس مختصات ایونت
      position: { top: 'auto', left: 'auto', right: 'auto', bottom: 'auto' } // حذف محدودیت موقعیت
    });

    // فراخوانی ایجکس برای دریافت اطلاعات رزرو از سمت سرور
    $.ajax({
      url: 'account/get_reservation_info/', // آدرس مورد نظر برای دریافت اطلاعات رزرو
      method: 'GET',
      data: { reservation_id: ev.reserve_id }, // ارسال شناسه رزرو به سمت سرور
      success: function (data) {
        fillPopupWithData(data);
        popup.open();
      },
      error: function () {
        alert('خطا در دریافت اطلاعات رزرو');
      }
    });
  }
  
  var now = new Date();
  var yesterday = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1);

  function fillPopupWithData(data) {
    // مثال: تنظیم عنوان و متن رزرو در پاپ آپ

    console.log(data.morecapacity)
    $('#event-title').val(data.title);
    $('#event-status').val(data.status);
    $('#event-buffer').val(data.bufferAfter);
    if (data.bufferAfter)
      {
          $( "#event-buffer").prop('checked', true);
      }
      else
      {
          $( "#event-buffer").prop('checked', false);
      }
    $('#event-user').val(data.user);
    $('#start-input').val(data.start);
    $('#end-input').val(data.end);
    $('#event-resource').val(data.resources);
    $('#event-cleaning').prop('checked', data.cleaning);
    $('#event-capacity').text(data.capacity + ' نفر مجاز/ظرفیت بیشتر ');
    $('#event-more-capacity').val(data.morecapacity);
    $('#event-paid').prop('checked', data.paid);
    $('#event-price').text(data.price),
    $('#event-price-per-person').text(data.price_per_person),
    $('#event-pay').text('مبلغ نهایی: ' + data.totalCost + ' تومان');


    firstday = data.start;
    lastday = data.end;
    datepickerreserve.setVal([firstday, lastday]);
  }
  var formatDate = mobiscroll.formatDate;
  var startDate;
  var endDate;
  var end;

  var myCalendar = mobiscroll.eventcalendar('#demo-add-delete-event', {
    locale: mobiscroll.localeFa,
    clickToCreate: 'double',
    dragToCreate: true,
    dragToMove: false,
    dragToResize: false,
    rtl: true,
    view: {
      timeline: {
        type: 'year', 
        size: 30,
        },
    },
    invalid:invalidreservation,
    data: reservationData,
    resources: resourceData,
    // colors: [
    //   {
    //     background: '#F5F8F2',
    //     slot: 1,
    //     recurring: {
    //       repeat: 'weekly',
    //       weekDays: 'SA',
    //     },
    //   },
    // ],
    renderHeader: function () {
      return (
        '<div class="m-1 p-1 mbsc-button-mycalendar md-custom-range-view-controls">' +
        '<div mbsc-calendar-today></div>' +
        '</div>' +
        '<div id="custom-date-range"></div>' +
        '<label>' +
        'شروع:' +
        '<input id="start" mbsc-input placeholder="کلیک کنید" />' +
        '</label>' +
        '<label>' +
        'پایان:' +
        '<input id="end" mbsc-input placeholder="کلیک کنید" />' +
        '</label>'
      );
    },
    onPageLoaded: function (args) {
      startDate = args.firstDay;
      end = args.lastDay;
      endDate = new Date(end.getFullYear(), end.getMonth(), end.getDate() - 1, 0);
      // set button text
      console.log("startDate")
    
      console.log(startDate)
      // rangeButton.innerText = getFormattedRange(startDate, endDate);
      // // rangeButton.innerText = 'انتخاب تاریخ ورود و خروج';
      // // set range value
      // myRange.setVal([startDate, endDate]);
    },
    onEventClick: function (args) {
      tempEvent = args.event;  
      console.log(tempEvent)  
      if (!popup.isVisible()) {
        createEditPopup(args);
      }
    },
    onEventCreated: function (args) {
      resourceId = args.event.resource;
      popup.close();
      tempEvent = args.event;
      createAddPopup(args.target, resourceId,tempEvent);
    },
    onEventDeleted: function (args) {
      mobiscroll.snackbar({
        button: {
          action: function () {
            myCalendar.addEvent(args.event);
          },
          text: 'Undo',
        },
        message: 'Event deleted',
      });
    },
  });

//   mobiscroll.scrollview('.mbsc-timeline-grid-scroll', {
//     theme: 'ios',
//     themeVariant: 'light',
//     itemWidth: 80,
//     paging: true,
// });

  popup = mobiscroll.popup('#demo-add-popup', {
    display: 'bottom',
    contentPadding: false,
    fullScreen: true,
    onClose: function () {
        if (deleteEvent) {
          myCalendar.removeEvent(tempEvent);
        } else if (restoreEvent) {
          myCalendar.updateEvent(oldEvent);
        }
      },
    responsive: {
      medium: {
        display: 'anchored',
        width: 400,
        height:1200,
        fullScreen: false,
        touchUi: false,
      },
    },
  });

  deleteButton.addEventListener('click', function () {
    var deletedEvent = tempEvent;
    myCalendar.removeEvent(tempEvent);
    $.ajax({
      url: 'account/remove_reservation/', // آدرس مورد نظر برای دریافت اطلاعات رزرو
      method: 'POST',
      data: { 
        csrfmiddlewaretoken: '{{ csrf_token }}',
        reservation_id: tempEvent.reserve_id 
      }, // ارسال شناسه رزرو به سمت سرور
      success: function (data) {
        popup.close();
        
      },
      error: function () {
        alert('خطا در دریافت اطلاعات رزرو');
      }
    });
  });

  var myRange = mobiscroll.datepicker('#custom-date-range', {
    select: 'range',
    startInput: '#start',
    endInput: '#end',
    display: 'center',
    showOverlay: false,
    locale: mobiscroll.localeFa,
    touchUi: true,
    rtl: true,
    buttons: [],
    onClose: function (args, inst) {
      var date = inst.getVal();
      if (date[0] && date[1]) {
        if (date[0].getTime() !== startDate.getTime()) {
          // navigate the calendar
          var newDate = date[0].getTime() - (5 * 24 * 60 * 60 * 1000);
          var newStartDate = new Date(newDate);
          console.log(newStartDate)
          myCalendar.navigate(newStartDate);
        }
        startDate = date[0];
        endDate = date[1];
        // set calendar view
        myCalendar.setOptions({
          refDate: startDate,
          view: {
            timeline: {
              type: 'year',
              size: 31,
              eventList: false,
            },
          },
          invalid: [{
              // Date objects
              allDay: true,
              start: '2024-03-10T00:00',
              end: date[0],
              title: 'عدم نمایش',
              cssClass: 'md-lunch-break-class mbsc-flex',
            },
            {
              allDay: true,
              start: endDate,
              end: '2025-03-10T00:00',
              title: 'عدم نمایش',
              cssClass: 'md-lunch-break-class mbsc-flex',
            },  
          ],
        });
      } else {
        myRange.setVal([startDate, endDate]);
      }
    },
  });

  var rangeButton = document.getElementById('custom-date-range-text');

  // returns the formatted date
  function getFormattedRange(start, end) {
    return (
      formatDate('MMM D, YYYY', new Date(start)) +
      (end && getNrDays(start, end) > 1 ? ' - ' + formatDate('MMM D, YYYY', new Date(end)) : '')
    );
  }

  // returns the number of days between two dates
  function getNrDays(start, end) {
    return Math.round(Math.abs((end.setHours(0) - start.setHours(0)) / (24 * 60 * 60 * 1000))) + 1;
  }

  // addremindersmsButton.addEventListener('click', function () {
  //   console.log(tempEvent);
  //   $.ajax({
  //     url: 'account/addـreminderـsms/', // آدرس مورد نظر برای دریافت اطلاعات رزرو
  //     method: 'POST',
  //     data: { 
  //       csrfmiddlewaretoken: '{{ csrf_token }}',
  //       reservation_id: tempEvent.reserve_id 
  //     }, // ارسال شناسه رزرو به سمت سرور
  //     success: function (data) {
  //       popup.close();
  //     },
  //     error: function () {
  //       alert('خطا در دریافت اطلاعات رزرو');
  //     }
  //   });
  // });


  // $(document).ready(function () {
  //   $('#id_price_currency').select2();
  // });

</script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    // document.getElementById('event-resource').addEventListener('change', function() {
    document.querySelector('.mbsc-range-control-value').addEventListener('contentChanged', function() {
      var selectedResourceId = parseInt($(this).val(), 10); // Convert to integer
      var matchingResource = resourceData.find(function(resource) {
        return resource.id === selectedResourceId;
      });
      if (matchingResource) {
        $('#event-capacity').text(matchingResource.capacity + ' نفر');
      } else {
          // Handle the case when no matching resource is found
        $('#event-capacity').text('نفری یافت نشد');
      }
      console.log("Matching Resource:", matchingResource);

    });
  });
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  document.getElementById('demo-range-selection').addEventListener('change', function() {
    // Get the new value of datepickerreserve
    var reservtime = datepickerreserve.getVal();
    var startreserve = new Date(reservtime[0]);
    var endreserve = new Date(reservtime[1]);
    console.log("differenceInDays")


    // Calculate the difference in days
    var oneDay = 24 * 60 * 60 * 1000; // hours * minutes * seconds * milliseconds
    var differenceInDays = Math.round((endreserve - startreserve) / oneDay)+ 1;
    console.log(differenceInDays)

    // Get the resource price (replace this with your logic to get the actual price)
    var resourcePrice = document.getElementById('event-price').textContent;
    console.log(resourcePrice)

    // Calculate the total cost
    var totalCost = differenceInDays * resourcePrice;
    console.log("totalCost")
    // Set the value of the event-pay button
    $('#event-pay').text('مبلغ نهایی: ' + totalCost + ' تومان');
  });

  // Get the horizontal scrollbar element
  var horizontalScrollbar = document.querySelector('.mbsc-timeline-grid-scroll');
  // Listen for the scroll event on the horizontal scrollbar
  horizontalScrollbar.addEventListener('scroll', function() {
      // Check if scrolling has stopped
      if (!this._scrolling) {
          // Set a flag to indicate scrolling has started
          this._scrolling = true;
          var self = this;
          setTimeout(function() {
              // Get the scroll position
              var scrollLeft = horizontalScrollbar.scrollLeft;
              // Get the width of the first column
              var firstColumnWidth = document.querySelector('.mbsc-timeline-column').offsetWidth;

              // Calculate the index of the nearest visible column
              var columnIndex = Math.round(scrollLeft / firstColumnWidth);

              // Calculate the new scroll position to fully display the nearest visible column
              var newScrollLeft = columnIndex * firstColumnWidth;

              // Scroll to the new position
              horizontalScrollbar.scrollTo({
                  left: newScrollLeft,
                  behavior: 'smooth' // Optional: smooth scrolling effect
              });

              // Reset the scrolling flag
              self._scrolling = false;
          }, 400); // Adjust the delay as needed
      }
  });
});

</script>

<!-- bt and modal script for close time add -->
<!-- bt and modal script for close time add -->
<script>
  // Get a reference to the modal element
  var modal = new bootstrap.Modal(document.getElementById('myModal'));

  // Get the button that opens the modal
  var btn = document.getElementById('openModalBtn');

  // Event listener for opening the modal when the button is clicked
  btn.addEventListener('click', function() {
    modal.show();
  });

  // Get a reference to the close button inside the modal
  var closeBtn = document.querySelector('.modal .btn-close');

  // Event listener for closing the modal when the close button is clicked
  closeBtn.addEventListener('click', function() {
    modal.hide();
  });
</script>
{% endblock %}


{% block vondors-js %}
<script src="{% static 'vendor/libs/fullcalendar/fullcalendar.js' %}"></script>
<script src="{% static 'vendor/libs/formvalidation/dist/js/FormValidation.min.js' %}"></script>
<script src="{% static 'vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js' %}"></script>
<script src="{% static 'vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js' %}"></script>
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script>
<script src="{% static 'vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/fa-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
{% endblock %}

{% block page-js %}
<script src="{% static 'js/app-calendar-events.js' %}"></script>
<script src="{% static 'js/app-calendar.js' %}"></script>
{% endblock %}
