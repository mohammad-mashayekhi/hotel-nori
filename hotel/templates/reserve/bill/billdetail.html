{% extends 'account/base.html' %}
{% load static %}
{% load jformat %}
{% block vendors-css %}
<!-- Vendors CSS -->
<!--suppress SpellCheckingInspection -->
    <link rel="stylesheet" href="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/node-waves/node-waves.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/typeahead-js/typeahead.css' %}" />
<link rel="stylesheet" href="{% static 'vendor/libs/flatpickr/flatpickr.css' %}" />
<!-- Page CSS -->
<link rel="stylesheet" href="{% static 'vendor/css/pages/app-invoice.css' %}" />
{% endblock %}
{% block content %}
<!-- Content -->
<div class="container-xxl flex-grow-1 container-p-y">
  <div class="row invoice-preview">
    <!-- Invoice -->
    <div class="col-xl-9 col-md-8 col-12 mb-md-0 mb-4">
      <div class="card invoice-preview-card">
        <div class="card-body">
          <div class="d-flex justify-content-between flex-xl-row flex-md-column flex-sm-row flex-column">
            <div class="mb-xl-0 pb-3">
              <div class="d-flex svg-illustration align-items-center gap-2 mb-4">
                <h5 lang="fa" style="">فاکتور : {{ reservation.reserve_id }}</h5>
              </div>
              <p class="mb-1" lang="fa" style="">حسینیه مرحوم مهدیان - {{reservation.resource}}</p>
            </div>
            <div>
              <div class="mb-1">
                <span lang="fa" style=""><span>تاریخ انتشار:</span> <span>{{reservation.get_created_at_dhamsi}}</span></span>
              </div>
            </div>
          </div>
        </div>
        <hr class="my-0">
        <div class="card-body">
          <div class="d-flex justify-content-between flex-wrap">
            <div class="my-3">
              <h6 class="pb-2" lang="fa">فاکتور به:</h6>
              <p class="mb-1" lang="fa"> نام و خوانوادگی: {{ reservation.user.get_full_name }}</p>
              <p class="mb-1" lang="fa"> کدملی: {{ reservation.user.national_code }}</p>
              <p class="mb-0" lang="fa"> شماره همراه: {{reservation.user.mobile_number}}</p>
            </div>
            <div class="my-3">
              <h6 class="pb-2" lang="fa" style="">بیل به:</h6>
              <table>
                <tbody>
                  <tr>
                    <td class="pe-3 fw-medium" lang="fa" style="">مجموع به علت:</td>
                    <td lang="fa" style="">$12،110.55</td>
                  </tr>
                  <tr>
                    <td class="pe-3 fw-medium" lang="fa">نام بانک:</td>
                    <td lang="fa" style="">بانک امریکایی</td>
                  </tr>
                  <tr>
                    <td class="pe-3 fw-medium" lang="fa">کشور:</td>
                    <td lang="fa" style="">ایالات متحده</td>
                  </tr>
                  <tr>
                    <td class="pe-3 fw-medium" lang="fa" style="">ایبان:</td>
                    <td lang="fa" style="">دانلود: ETD95476213874685.000</td>
                  </tr>
                  <tr>
                    <td class="pe-3 fw-medium" lang="fa" style="">کد سوئیفت:</td>
                    <td lang="fa">BR91905 (برزیلی)</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <hr>
          <div class="d-flex justify-content-between flex-wrap">
            <div class="my-3">
                <form action="/coupon/apply/" method="post">
                  {% csrf_token %}
                  <div class="form-floating form-floating-outline mb-4">
                          <input type="text" id="coupon" class="form-control" name="coupon">
                          <label for="coupon" style="text-align: right;" lang="fa">کدتخفیف </label>  
                  </div>    
                  <input type="hidden" value="{{ reservation.reserve_id }}" name="reservation_id" >
                  <button type="submit" class="btn btn-primary me-3 waves-effect waves-light" lang="fa">اعمال کد تخفیف</button>
              </form>
            </div>
            <div class="my-3">
                {% if coupon %}
                      <h6 class="pb-2" lang="fa" style="">تخفیف:</h6>
                      <table>
                        <tbody>
                          <tr>
                            <td class="pe-3 fw-medium" lang="fa" style="">مقدار کل:</td>
                            <td lang="fa" style="">{{ reservation.total_pay }}</td>
                          </tr>
                          <tr>
                            <td class="pe-3 fw-medium" lang="fa">مقدار تخفیف به درصد:</td>
                            <td lang="fa" style="">{{ coupon.discount }}%</td>
                          </tr>
                          <tr>
                            <td class="pe-3 fw-medium" lang="fa">مقدار تخفیف به تومان:</td>
                            <td lang="fa" style="">{{ discount }} تومان</td>
                          </tr>
                          <tr>
                            <td class="pe-3 fw-medium" lang="fa" style="">مقدار  کل با تخفیف:</td>
                            <td lang="fa" style="">{{ total_pay_with_discount }}</td>
                          </tr>
                        </tbody>
                      </table>
              {% elif messages %}
                  <ul class="messages fw-bold my-3 "> 
                      {% for message in messages %}
                            <li class="{{ message.tags }}">{{ message }}</li>
                      {% endfor %}
                  </ul>
              {% endif %}    
            </div>    
          </div>
        </div>
        <div class="table-responsive">
          <table class="table m-0">
            <thead class="table-light border-top">
              <tr>
                <th lang="fa">شماره رزور</th>
                <th lang="fa"> وضعیت </th>
                <th lang="fa" style=""> هزینه کل</th>
                <th lang="fa">نام اتاق</th>
                <th lang="fa">شروع</th>
                <th lang="fa">پایان</th>  
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-nowrap" lang="fa">{{ reservation.reserve_id }}</td>
                <td class="text-nowrap" lang="fa">{{ reservation.get_status_display }}</td>
                <td lang="fa" style="">{{ reservation.total_pay }}</td>
                <td lang="fa">{{ reservation.resource.name }}</td>
                  <td>{{ reservation.start  | jformat:'%Y/%m/%d' }}</td>
                  <td>{{ reservation.end  | jformat:'%Y/%m/%d' }}</td>                
              </tr>
            </tbody>
          </table>
        </div>

        <div class="card-body">
          <div class="row">
            <div class="col-12">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /Invoice -->

    <!-- Invoice Actions -->
    <div class="col-xl-3 col-md-4 col-12 invoice-actions">
      <div class="card">
        <div class="card-body">
          <button class="btn btn-primary d-grid w-100 mb-3 waves-effect waves-light" data-bs-toggle="offcanvas"
            data-bs-target="#sendInvoiceOffcanvas">
            <span class="d-flex align-items-center justify-content-center text-nowrap"><i
                class="mdi mdi-send-outline scaleX-n1-rtl me-1"></i>
              <span lang="fa">ارسال فاکتور</span>
            </span>
          </button>
          <button class="btn btn-outline-secondary d-grid w-100 mb-3 waves-effect" lang="fa"> دانلود </button>
          <a class="btn btn-outline-secondary d-grid w-100 mb-3 waves-effect" target="_blank"
             href="{% url 'reserve:billprint' reservation.reserve_id %}" lang="fa"> چاپ </a>
        {% if request.user.uesr_status == "admin_level_2" %}
          <a href="app-invoice-edit.html" class="btn btn-outline-secondary d-grid w-100 mb-3 waves-effect"
             lang="fa"> ویرایش فاکتور </a>
        {% endif %}
        {% if reservation.status == "pending_payment" %}
            <button class="btn btn-success d-grid w-100 waves-effect waves-light" data-bs-toggle="offcanvas"
            data-bs-target="#addPaymentOffcanvas">
            <span class="d-flex align-items-center justify-content-center text-nowrap"><i
                class="mdi mdi-currency-usd me-1"></i>
              <span lang="fa">اضافه کردن پرداخت</span>
            </span>
          </button>
        {% endif %}
        </div>
      </div>
    </div>
    <!-- /Invoice Actions -->
  </div>
  <!-- Offcanvas -->
  <!-- Send Invoice Sidebar -->
  <div class="offcanvas offcanvas-end" id="sendInvoiceOffcanvas" aria-hidden="true">
    <div class="offcanvas-header mb-3">
      <h5 class="offcanvas-title" lang="fa">ارسال فاکتور</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"
      ></button>
    </div>
    <div class="offcanvas-body flex-grow-1">
      <form>
        <div class="form-floating form-floating-outline mb-4">
          <input type="text" class="form-control" id="invoice-from" value="shelbyComapny@email.com"
            placeholder="company@email.com">
          <label for="invoice-from" style="text-align: right;" lang="fa">از</label>
        </div>
        <div class="form-floating form-floating-outline mb-4">
          <input type="text" class="form-control" id="invoice-to" value="qConsolidated@email.com"
            placeholder="company@email.com">
          <label for="invoice-to" style="text-align: right;" lang="fa">به</label>
        </div>
        <div class="form-floating form-floating-outline mb-4">
          <input type="text" class="form-control" id="invoice-subject" value="Invoice of purchased Admin Templates"
            placeholder="Invoice regarding goods">
          <label for="invoice-subject" style="text-align: right;" lang="fa">موضوع</label>
        </div>
        <div class="form-floating form-floating-outline mb-4">
          <textarea class="form-control" name="invoice-message" id="invoice-message" style="height: 190px;">Dear Queen Consolidated,
                        Thank you for your business, always a pleasure to work with you!
                        We have generated a new invoice in the amount of $95.59
                        We would appreciate payment of this invoice by 05/11/2021</textarea>
          <label for="invoice-message" style="text-align: right;" lang="fa">پیام</label>
        </div>
        <div class="mb-4">
          <span class="badge bg-label-primary">
            <i class="mdi mdi-link-variant mdi-14px me-1"></i>
            <span class="align-middle" lang="fa">فاکتور پیوست شده</span>
          </span>
        </div>
        <div class="mb-3 d-flex flex-wrap">
          <button type="button" class="btn btn-primary me-3 waves-effect waves-light" data-bs-dismiss="offcanvas"
                  lang="fa">ارسال</button>
          <button type="button" class="btn btn-label-secondary waves-effect" data-bs-dismiss="offcanvas"
                  lang="fa">لغو</button>
        </div>
      </form>
    </div>
  </div>
  <!-- /Send Invoice Sidebar -->

  <!-- Add Payment Sidebar -->
  <div class="offcanvas offcanvas-end" id="addPaymentOffcanvas" aria-hidden="true">
    <div class="offcanvas-header mb-3">
        {% if reservation.status == "pending_payment" %}
            <h5 class="offcanvas-title" lang="fa">اضافه کردن پرداخت</h5>
        {% endif %}      
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"
        ></button>
    </div>
  {% if reservation.status == "pending_payment" %}
    <div class="offcanvas-body  flex-grow-1">
      <div class="d-flex justify-content-between bg-lighter p-2 mb-3" >
        <p class="mb-0" lang="fa">مبلغ پرداختی :</p>
        <p class="fw-bold mb-0" lang="fa">{{ reservation.total_pay }}</p>
      </div>
      <div class="d-flex justify-content-between bg-lighter p-2 mb-3" >
        <p class="mb-0" lang="fa"> {{ coupon.discount }}  درصد تخفیف :</p>
        <p class="fw-bold mb-0" lang="fa">{{ dicount }}</p>
      </div>      
      <div class="d-flex justify-content-between bg-lighter p-2 mb-3" >
        <p class="mb-0" lang="fa">: مقدار کل با تخفیف</p>
        <p class="fw-bold mb-0" lang="fa">{{ total_pay_with_discount }}</p>
      </div>            
      <div  >  
          <form action="{% url 'zarinpal:request' %}" method="post">
              {% csrf_token %}
             <input type="hidden" id="order_id" name="order_id" value="{{ reservation.reserve_id }}"> 
            <div class="form-floating form-floating-outline mb-4">
                <label for="description"></label><textarea class="form-control" id="description" name="description" style="height: 62px;">صورت حساب روز حسینیه به شماره فاکتور
                   {{ reservation.reserve_id }}   </textarea>
              <label for="payment-note" style="text-align: right;" lang="fa">یادداشت پرداخت </label>
            </div>
            <div class="mb-3 d-flex flex-wrap">
                
              <button type="submit" class="btn btn-primary me-3 waves-effect waves-light"
                      lang="fa">ارسال</button>
            </div>
          </form>
      </div>
    </div>
  {% endif %}
  </div>
  <!-- /Add Payment Sidebar -->
  <!-- /Offcanvas -->
</div>
<!-- / Content -->
{% endblock %}
{% block vondors-js %}
<!-- Vendors JS -->
<script src="{% static 'vendor/libs/moment/moment.js' %}"></script>
<script src="{% static 'vendor/libs/jdate/jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/flatpickr-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/flatpickr/fa-jdate.js' %}"></script>
<script src="{% static 'vendor/libs/cleavejs/cleave.js' %}"></script>
<script src="{% static 'vendor/libs/cleavejs/cleave-phone.js' %}"></script>
{% endblock %}
{% block page-js %}
<!-- Page JS -->
<script src="{% static 'js/offcanvas-add-payment.js' %}"></script>
<script src="{% static 'js/offcanvas-send-invoice.js' %}"></script>
{% endblock %}