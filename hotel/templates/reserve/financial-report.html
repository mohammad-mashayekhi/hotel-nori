{% extends 'account/base.html' %}
{% load static %}

{% block vendors-css %}
<link href="https://unpkg.com/tabulator-tables@5.4.4/dist/css/tabulator.min.css" rel="stylesheet">
    <script src="https://unpkg.com/tabulator-tables@5.4.4/dist/js/tabulator.min.js"></script>
{% endblock %}

{% block page-css %}
<style>
  .custom-scroll {
      max-height: 300px; /* حداکثر ارتفاع */
      overflow-y: auto; /* فعال کردن اسکرول */
  }
</style>
<!-- <link rel="stylesheet" href="https://cdn.datatables.net/2.0.7/css/dataTables.dataTables.css" />
<link rel="stylesheet" href="{% static 'vendor/libs/perfect-scrollbar/perfect-scrollbar.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/node-waves/node-waves.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/typeahead-js/typeahead.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-bs5/datatables.bootstrap5.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css' %}"/>
<link rel="stylesheet" href="{% static 'vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css' %}"/> -->
{% endblock %}

{% block content %}

<!-- Bordered Table -->
<div class="container-xxl flex-grow-1 container-p-y">
    <div class="card">
        <h5 class="card-header">گزارش مالی</h5>
        <div class="card-body">
        <small class="fw-medium">انتخاب سال</small>
        <div class="demo-inline-spacing mb-4">
          <div class="btn-group">
            <button type="button" class="btn btn-label-primary dropdown-toggle d-flex justify-content-between align-items-center"
            style="width: 160px !important;" data-bs-toggle="dropdown" aria-expanded="false">
              {{ selected_year }}
            </button>
            <ul class="dropdown-menu custom-scroll">
              {% for year in years %}
              <li><a class="dropdown-item" href="{% url 'reserve:financial-report' year %}">{{ year }}</a></li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="table-responsive text-nowrap">
            <table class="table table-bordered">
            <thead>
                <tr>
                <th>اتاق‌ها/ماه</th>
                {% for number, month in months %}
                <th>{{ month }}</th>
                {% endfor %}
                <th>درصد میانگین <br> اشغال اتاق</th>
                </tr>
            </thead>
            <tbody>
                {% for room_name, room_data in list_of_a_year.items %}
                <tr>
                    <td><i class="fab fa-angular fa-lg text-danger me-3"></i> <span class="fw-medium">{{ room_name }}</span></td>
                    <!-- درصد اشغال‌شدگی ماهانه -->
                    {% for month, percent in room_data.monthly.items %}
                    <td>
                        {% if percent == 0 %}
                            0
                        {% else %}
                            %{{ percent  | floatformat:2  }}
                        {% endif %}
                    </td>
                    {% endfor %}
                    <!-- میانگین درصد اشغال‌شدگی سالانه -->
                    <td>
                        {% if room_data.yearly == 0 %}
                            0
                        {% else %}
                            %{{ room_data.yearly  |floatformat:2  }}
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
                <tr>
                  <td>درصد میانگین <br>اشغال در ماه</td>
                  {% for month, avg_precent in avg_in_months.items %}
                  <td>
                    {% if avg_precent == 0 %}
                      0
                    {% else %}
                      %{{ avg_precent  | floatformat:2  }}
                    {% endif %}
                  </td>
                  {% endfor %}
                </tr>
            </tbody>
            </table>
        </div>
        </div>
    </div>
</div>
<!--/ Bordered Table -->

{% endblock %}




{% block page-js %}
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="{% static 'vendor/libs/select2/select2.js' %}"></script> -->
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.datatables.net/2.0.7/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/plug-ins/1.13.4/i18n/fa.json"></script>
<script>
  $(document).ready( function () {
    var table = $('#TableofR').DataTable({
      language: {
        url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/fa.json'
      }
    });
    var table = $('#datatable').DataTable({
      paging: false,
      dom: 'lrtip', // remove the default search box
      fixedHeader: {
        header: true,
        footer: true
      },
      paging: false,
      scrollCollapse: true,
      scrollX: true,
      scrollY: 380,
      ordering: false,
    });

    // Create the range filtering function
    $.fn.dataTable.ext.search.push(
      function(settings, data, dataIndex) {
        var min = parseInt($('#min-price').val(), 10);
        var max = parseInt($('#max-price').val(), 10);
        var price = parseFloat(data[12]) || 0; // use data for the 'Total Pay' column

        if ((isNaN(min) && isNaN(max)) ||
              (isNaN(min) && price <= max) ||
              (min <= price && isNaN(max)) ||
              (min <= price && price <= max)) {
            return true;
        }
        return false;
      }
    );

    $('#status-filter').on('change', function() {
      var value = $(this).val();
      table.column(9).search(value).draw();
    });

    // Re-draw the table whenever the input values change
    $('#min-price, #max-price').on('keyup', function() {
      table.draw();
    });
  });
</script> -->
{% endblock %}